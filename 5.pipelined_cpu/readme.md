# 流水线CPU

流水线CPU共有5级：

（1）取指令IF

（2）指令译码ID

（3）指令执行EXE

（4）存储器访问MEM

（5）寄存器回写WB

流水线CPU的相关问题

1.结构相关：CPU在同时执行多条指令时竞争硬件资源而引起的冲突。

eg: 如果只用一个存储器模块来存放指令和数据，而且该存储器模块不支持两个同同时访问。

2.数据相关（重点讨论）：

流水线CPU同时执行多条指令，指令之间会出现数据相关的问题，即一条指令还没有执行完，而它的后续指令要使用它的结果。

内部前推（内部旁路）：直接把ALU的结果送给下一条指令。

ALU的计算结果可以从EXE级和MEM级前推到ID级，而lw指令从数据存储器读出的数据智能从MEM级前推到ID级。这意味着lw的后续指令如何与lw数据相关，需要把流水线暂停一个周期（“留级”）。（需要放弃一次指令的执行）

3.控制相关（重点讨论）：

流水线CPU在执行转移或跳转指令时会出现控制相关的问题，即在实际转向目标地址之前，转移或跳转指令的后续指令已经渠道商流水线中来了。

解决控制相关问题的方法：废弃后续指令的执行、延迟转移、转移预测等。

这里使用延迟转移技术来解决流水线CPU的控制相关问题。



MIPS转移类指令的延迟转移特性在单周期和多周期CPU设计中被忽略。

“jal指令，PC+8，EXE级增加加法器”



流水线CPU的整体电路构成：

1.PC、IF级的组合电路

2.IF级与ID级之间的流水线寄存器

3.ID级的组合电路

4.ID级与EXE级之间的流水线寄存器

5.EXE级的组合电路

6.EXE级与MEM级之间的流水线寄存器

7.MEM级的组合电路

8.MEM级与WB级之间的流水线寄存器

9.WB级的组合电路



代码从CPU开始没有从computer开始。

设计computer模块

在pipeif中访问了指令存储器 pipeimem，在pipelinedcpu中访问了数据存储器pipemem，所以不需要设计computer模块。直接给时钟信号即可。本次模拟中没有对memclk信号额外赋值，所以还是使用ppt上的模块，删除memclk信号。